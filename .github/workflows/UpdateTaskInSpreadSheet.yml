name: Update Task via GAS

on:
  pull_request:
    types: [opened, edited, reopened]

jobs:
  update-task:
    runs-on: ubuntu-latest

    steps:
      - name: Extract Task ID from PR title
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          # "##123" ã®ã‚ˆã†ãªå½¢å¼ã‹ã‚‰æ•°å­—éƒ¨åˆ†ã ã‘æŠ½å‡º
          TASK_ID=$(echo "$PR_TITLE" | grep -oP '(?<=##)\d+')
          if [ -z "$TASK_ID" ]; then
            echo "âŒ ã‚¿ã‚¹ã‚¯IDãŒPRã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ"
            exit 1
          fi
          echo "TASK_ID=$TASK_ID" >> $GITHUB_ENV
          echo "ğŸ“Œ å–å¾—ã—ãŸã‚¿ã‚¹ã‚¯ID: $TASK_ID"

      - name: Call GAS (Complete Task)
        run: |
          curl -s -X POST "${{ secrets.GAS_URL }}" \
               -H "Content-Type: application/json" \
               -d "{\"mode\":\"complete\",\"taskId\":\"${TASK_ID}\"}" \
            | tee response.json
          echo "ğŸ“¡ GASãƒ¬ã‚¹ãƒãƒ³ã‚¹:"
          cat response.json

